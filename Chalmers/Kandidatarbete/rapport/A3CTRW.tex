\newcommand{\Pk}{\widehat{P}}
\newcommand{\Pks}{\widetilde{\widehat{P}}}
\newcommand{\pk}{\hat{p}}
\newcommand{\PPs}{\widetilde{P'}}
\newcommand{\psis}{\widetilde{\psi}}
\newcommand{\PSIs}{\widetilde{\Psi}}

\newcommand{\Xs}{\widetilde{X}(s)}

\chapter{Fördjupning i CTRW och subdiffusion}


\label{app:CTRW} 
Följande bilaga om fördjupning i CTRW och subdiffusion  följer till stor del från \cite{Chu_2003} och \cite{Vahey_2006}. Continuous time random walk är en modell där rörelsen för till exempel en partikel beskrivs av 
\begin{equation}
    X(t) = \sum_{i=1}^{n(t)} \Delta x_i,
\end{equation}
där $\Delta x_i$ är oberoende likafördelade steg med sannolikhetsfördelning $p(x)$. Till skillnad mot en enklare slumpvandring så sker inte stegen med jämna tidsintervall. Tiden mellan stegen är slumpmässiga och följer en sannolikhetsfördelning $\psi (t)$ vilket schematiskt visas i \figref{fig:CTRW}. Hädanefter antas att $\psi(t)$ är identiska samt oberoende för alla steg, det finns teorier som studerar så kallad ''aging CTRW''\cite{Barkai_ACTRW2002} där detta inte gäller. Vidare betecknas sannolikhetsfördelningen att $n$ stycken steg har skett efter en tid $t$ som $P'(n,t)$ och $p_n(x)$ som sannolikhetsfördelningen att befinna sig vid $x$ efter $n$ stycken steg. Givet dessa definitioner är sannolikhetsfördelningen att befinna sig vid $x$ efter en tid $t$ precis 
\begin{equation}
\label{eq:P(x,t)}
    P(x,t) =\sum_{n=0}^{\infty} P'(n,t)p_n(x).
\end{equation}

För att beräkna godtyckliga moment av $X(t)$, av speciellt intresse är väntevärdet och andramomentet, så betraktas fouriertransformen av $P(x,t)$
\begin{equation}\label{eq:four}
\Pk (k,t) = \int_{-\infty}^{\infty} P(x,t)\ee^{\ii kx}\id{x}.
\end{equation}
Från fouriertransformen kan godtyckligt moment beräknas enligt 
\begin{equation}\label{eq:moment}
\ev{X(t)^n} = (-\ii)^n \eval{\frac{\pd^n \Pk (k,t)}{\pd k^n}}_{k=0}
\end{equation}. 

Sannolikhetsfördelningen för att nå $x$ efter $n$ antal steg visar sig beskrivas av en faltning $p(x)^{*n}$, där notationen betyder 
\begin{equation}
p_n(x) = p(x)^{*n} = p(x)*p(x)*\ldots*p(x),
\end{equation}
%\begin{comment}
\begin{figure}
    \centering
    \input{bilder/bilaga/ctrw.pdf_t}
    \caption{En realisation av CTRW där partikeln hoppar från $x_0$ till $x_1$ efter en tid $t_1$ och till $x_2$ efter en tid $t_2$. Till skillnad mot enkel slumpvandring då $t_1\equiv t_2$ så är i allmänhet $t_1\neq t_2$ för CTRW.}
    \label{fig:CTRW}
\end{figure}
%\end{comment}
och $*$ betecknar faltning så att $p(x)$ faltas $n$ gånger med sig själv. Detta inses lättast genom att betrakta två steg
\begin{equation}\label{eq:nfaltning}
    p_2(x) = \int_{-\infty}^{\infty} p(x-x')p(x')\id{x'},
\end{equation}
där man integrerar över alla $x'$ sannolikheten att första steget sker till en position $x'$, och andra steget till $x$ från $x'$. Från detta inses det att \eqref{eq:nfaltning} kan generaliseras för $n$ antal steg. Fouriertransformen av \eqref{eq:P(x,t)} blir
\begin{equation}\label{eq:Pfour}
\Pk (k,t) =\sum_{n=0}^{\infty} P'(n,t)\pk (k)^n,
\end{equation}
där $\pk (k)$ är fouriertransformen av $p(x)$, vidare används egenskapen att faltning i $x$-rummet motsvarar multiplikation i $k$-rummet. Det underlättar nu att beskriva $P'(n,t)$ i termer av sannolikhetsfördelningen $\psi (t)$. Detta görs enklast genom att notera att sannolikheten att \emph{inget} steg sker under en tid $t$ är 
\begin{equation}\label{eq:nojump}
\Psi (t) \equiv 1-\int_0^t \psi(t')\id{t'} = \int_t^{\infty} \psi(t')\id{t'}. 
\end{equation}
Givet detta är sannolikheten att \emph{ett} steg sker under en tid $t$
\begin{equation}\label{eq:psifalt}
P'(1,t) = \int_0^t\psi(t')\Psi(t-t')\id{t'},
\end{equation}
där sannolikheten att ett steg sker vid $t'$ och sedan inget mer under en tid $t-t'$ integreras över alla $t'$. Eftersom sannolikhetsfördelningen $\psi (t)$ är identiskt noll för $t<0$, så är \eqref{eq:psifalt} ekvivalent med $P'(1,t) = \psi(t)*\Psi(t)$ och generaliserar till
\begin{equation}
P'(n,t) = \psi(t)^{*n}*\Psi(t).
\end{equation}
Detta uttryck kan förenklas genom ensidig laplacetransform i $t$ enligt 
\begin{equation}
\PPs (n,s) = \int_0^\infty P'(n,t)\ee^{-st}\id{t},
\end{equation}
vilket ger 
\begin{equation}
\PPs (n,s) = \psis(s)^n\PSIs(s),
\end{equation}
där $\psi(s)$ är laplacetransformen av $\psi(t)$ och likvärdigt för $\Psi(s)$. Från definitionen \eqref{eq:nojump} fås 
\begin{equation}
\PSIs(s) = \frac{1-\psis (s)}{s}.
\end{equation}
Insättning i \eqref{eq:Pfour}, där laplacetransformen av $P(n,t)$ utnyttjas, ger sambandet 
\begin{equation}
\Pks (k,s) = \sum_{n=0}^{\infty} \frac{1-\psis (s)}{s}[\psis (s)\pk (k)]^n.
\end{equation}
Genom att notera att detta är en geometrisk summa fås slutligen 
\begin{equation}\label{eq:master}
\Pks (k,s) = \frac{1-\psis (s)}{s\left(1-\psis (s)\pk (k)\right)}.
\end{equation}
Detta är Montroll-Weiss ekvationen för CTRW.

Genom att applicera \eqref{eq:moment} på detta samband kan väntevärdet samt andramomentet för $X(t)$ beräknas. Väntevärdet blir 
\begin{equation}
\ev{\Xs} = -\ii\frac{\pd \Pks (k,s)}{\pd k}\bigg |_{k=0},
\end{equation}
som med \eqref{eq:master} ger 
\begin{equation}
\ev{\Xs} = \frac{1-\psis (s)}{s}\frac{\psis (s)(-\ii\frac{\pd \pk (k)}{\pd k})}{\left(1-\psis (s)\pk (k)\right)^2}\bigg |_{k=0}.
\end{equation}
och ser vid en första anblick inte ut som framsteg. Men uttrycket förenklas eftersom
\begin{equation}
-\ii\frac{\pd \pk (k)}{\pd k}\bigg |_{k=0} = \ev{\Delta x}\quad\text{och}\quad\pk (k)\big |_{k=0} = 1,
\end{equation}
där $\ev{\Delta x}$ är väntevärdet av stegen som antas vara definierat.
Väntevärdet blir således 
\begin{equation}\label{eq:medels}
\ev{\Xs} = \frac{\psis (s)\ev{\Delta x}}{s\left(1-\psis (s)\right)}.
\end{equation}
Analogt kan andramomentet beräknas enligt 
\begin{equation}
\ev{\left(\Xs\right)^2} = -\frac{\pd^2 \Pks (k,s)}{\pd k^2}\bigg |_{k=0},
\end{equation}
vilket efter en liten exercis ger
\begin{equation}\label{eq:vars}
\ev{\left(\Xs\right)^2} = \frac{\ev{\Delta x^2}\psis (s)}{s(1-\psis (s))}+\frac{2\ev{\Delta x}^2\psis (s)}{s(1-\psis (s))^2},
\end{equation}
där $\ev{\Delta x^2}< \infty$. Således kan väntevärdet samt andramomentet för $\Xs$ beskrivas i termer av transformen av sannolikhetsfördelningen $\psi(t)$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}
Både väntevärdet och andramomentet kan dock uttryckas något mer intuitivt i termer av väntevärde och andramoment av antalet steg. Detta ses enligt följande 
\begin{equation}
   \ev{N(s)} = \frac{1-\psis (s)}{s}\sum_{N=0}^{\infty}N\psis (s)^N,
\end{equation}
som kan skrivas om som 
\begin{equation}
   \ev{N(s)} = \frac{1-\psis (s)}{s}\psis (s)\frac{\pd}{\pd \psis}\sum_{N=0}^{\infty}\psis (s)^N,
\end{equation}
vilket efter lite algebra ger 
\begin{equation}
   \ev{N(s)} = \frac{\psis (s)}{s(1-\psis (s)}.
\end{equation}
Således kan \eqref{eq:medels} även skrivas som $\ev{\Xs}=\ev{N(s)}\ev{\Delta x}$, och väntevärdet för positionen som funktion av tid 
\begin{equation}\label{eq:medelt}
   \ev{X(t)} = \ev{N(t)}\ev{\Delta x}.
\end{equation}
Analogt ses att $\ev{\left(N(s\right)^2}$ kan skrivas som
\begin{equation}
   \frac{1-\psis (s)}{s}\sum_{N=0}^{\infty}N^2\psis (s)^N = \frac{1-\psis (s)}{s}\left(\psis (s)\frac{\pd}{\pd \psis} \right)^2\sum_{N=0}^{\infty}\psis (s)^N,
\end{equation}
vilket kan förenklas till 
\begin{equation}
   \ev{\left(N(s)\right)^2} = \frac{\psis (s)}{s(1-\psis (s))}+\frac{2\psis (s)^2}{s(1-\psis (s))^2}.
\end{equation}
Givet detta kan \eqref{eq:vars} uttryckas som 
\begin{equation}
   \ev{\left(\Xs\right)^2} = \ev{N(s)}\ev{\Delta x^2}+\bigg (\ev{\left(N(s)\right)^2}-\ev{N(s)}\bigg )\ev{\Delta x}^2,
\end{equation}
och således blir
\begin{equation}\label{eq:vart}
      \ev{\left(X(t)\right)^2} = \ev{N(t)}\ev{\Delta x^2}+\left(\ev{\left(N(t)\right)^2}-\ev{N(t)}\right)\ev{\Delta x}^2.
\end{equation}

\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\subsubsection{Normal diffusion}
Då väntevärdet $\ev{t}=\tau<\infty$ så kan sannolikhetsfördelningen beskrivas enligt  
\begin{equation}
\psis (s) \sim 1-\tau s,
\end{equation}
när $s\to 0$. Givet denna fördelning och att $\ev{\Delta x}=0$ fås från \eqref{eq:medels}
\begin{equation}
   \ev{\Xs} = 0 \Longrightarrow \ev{X(t)} = 0
\end{equation}
som förväntat. På samma sätt ger \eqref{eq:vars}, där $\ev{\Delta x^2}$ är variansen av stegen,
\begin{equation}
   \ev{\left(\Xs\right)^2} \sim \frac{\ev{\Delta x^2}\left(1-\tau s\right)}{s\left(1-\left(1-\tau s\right)\right)} \sim \frac{\ev{\Delta x^2}}{\tau s^2}.
\end{equation}
Genom att transformera detta samband fås variansen som funktion av tid enligt 
\begin{equation}
    \ev{\left(X(t)\right)^2}-\ev{X(t)}^2 \sim \frac{\ev{\Delta x^2}t}{\tau},
\end{equation}
vilket gäller då $t\to\infty$. Variansen då $\ev{\Delta x}=0$ och $\tau<\infty$ blir proportionell mot tiden precis som förväntat.


\section{Subdiffusion}

Normal diffusion ses erhållas från CTRW när väntevärdet av tiden mellan steg är finit, $\ev{t}<\infty$. Det visar sig dock att subdiffusion erhålls om väntetiden mellan steg inte är definierad vilket demonstreras nedan. Antag att sannolikhetsfördelningen för väntetiderna i gränsen mot stora tider följer 
\begin{equation}
\psi(t) \sim \frac{1}{t^{\alpha+1}}\quad 0<\alpha<1,
\end{equation}
vilket är en sannolikhetsfördelning med odefinerad väntetid. För att evaluera såväl väntevärde som andramoment nedan kommer Tauberians teorem\cite{Feller_prob1971} användas och lyder för $\alpha\geq0$ samt då $s\to 0$ och $t\to\infty$:

\begin{equation}\label{eq:tauber}
   \psis (s)\sim\frac{1}{s^{\alpha+1}}\Longleftrightarrow \psi(t)\sim\frac{t^{\alpha}}{\Gamma (\alpha+1)},
\end{equation}
där $\Gamma(\alpha+1)$ är gammafunktionen.
Väntevärdet $\ev{\Xs}$ när $s\to 0$ för denna fördelning beräknas enligt \eqref{eq:medels} till
\begin{equation}
    \ev{\Xs} \sim \ev{\Delta x}\frac{1-As^{\alpha}}{As^{\alpha+1}} \sim \frac{\ev{\Delta x}}{As^{\alpha+1}},
\end{equation}
och med \eqref{eq:tauber}
\begin{equation}
    \ev{X(t)} \sim \frac{\ev{\Delta x}t^{\alpha}}{A\Gamma (1+\alpha)}.
\end{equation}
Om väntevärdet av steglängden är nollskild, blir alltså väntevärdet för positionen proportionell mot $t^{\alpha}$. Motsvarande beräkningar för andramoment fås från \eqref{eq:vars}
\begin{equation}
   \ev{\left(\Xs\right)^2} \sim \frac{(1-As^{\alpha})\ev{\Delta x^2}}{As^{\alpha+1}}+\frac{2(1-As^{\alpha})^2\ev{\Delta x}^2}{A^2s^{2\alpha+1}}.
\end{equation}

Betrakta nu två fall: $\ev{\Delta x}\neq0$ samt $\ev{\Delta x}=0$. För det första av dessa gäller att
\begin{equation}
   \ev{\left(\Xs\right)^2} \sim \frac{2\ev{\Delta x}^2}{A^2s^{2\alpha+1}}
\end{equation}
och enligt Tauberians teorem blir
\begin{equation}
   \ev{\left(X(t)\right)^2} \sim \frac{2\ev{\Delta x}^2t^{2\alpha}}{A^2\Gamma (2\alpha+1)}.
\end{equation}
Variansen ges då av  
\begin{equation}
    \ev{X(t)^2}-\ev{X(t)}^2 \sim \frac{2\ev{\Delta x}^2t^{2\alpha}}{A^2\Gamma (2\alpha+1)}-\frac{\ev{\Delta x}^2t^{2\alpha}}{A^2\Gamma (1+\alpha)^2}
\end{equation}


Då $\ev{\Delta x}=0$ gäller istället att

\begin{equation}
   \ev{\left(\Xs\right)^2}\sim \frac{\ev{\Delta x^2}}{As^{\alpha+1}},
\end{equation}
och motsvarande med avseende på tid 

\begin{equation}
   \ev{\left(X(t)\right)^2} \sim \frac{\ev{\Delta x^2}t^{\alpha}}{A\Gamma (\alpha+1)},
\end{equation}

vilket är precis variansen då $\ev{\Delta x}=0$.

Eftersom $0<\alpha<1$, ses att för båda fallen så kommer sannolikhetsfördelningen $\psi(t)\sim \frac{1}{t^{\alpha+1}}$, för stora $t$, leda till ett subdiffusivt beteende. Rörelsen blir alltså långsammare än vid klassisk brownsk rörelse. Det subdiffusiva beteende ses i den här modellen härstamma från att väntetiden mellan stegen är odefinierad. 

%Variansen då $\ev{\Delta x}=0$ ges av %\todo[color=lime]{Dvs MSD i form av stora S?}
%\begin{equation}
%   \ev{X(t)^2}-\ev{X(t)}^2 \sim \frac{\ev{\Delta x^2}t^{\alpha}}{A\Gamma (\alpha+1)}.
%\end{equation}

%\section{Simulering av CTRW}

%\todo[color=lime, inline]{Om vi väljer att ha med CTRW-simuleringarna}

%Bara en liten kodsnutt som behövs när man kompilerar lokalt
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "00main.tex"
%%% End: 