\input{template_files/packages}
\usepackage{units}
%\usepackage[T1]{fontenc}
%\usepackage[utf8]{inputenc}
\usepackage{physics}

\newcommand{\ee}{\mathrm{e}}
\newcommand{\ii}{\mathrm{i}}

\title{H1b: MD simulation -- dynamic properties}
\author{Andr\'eas Sundstr\"om and Linnea Hesslow}
\date{\today}

\begin{document}

\input{template_files/titlepage}

\section*{Introduction}

.... TODO... !!!!!!!!!!!!!!!!!!!!!

\section*{Task 1: potential energy}
The theoretical lattice parameter for aluminim can be determined by calculating the minimum potential energy per unit cell in a lattice with zero initial momenta for all particles. 

Figure~\ref{fig1} shows the potential energy as a function of the lattice parameter. We used a quadratic fit to find the minimum energy, and obtained $V_{\rm eq} \approx \unit[65.38]{\AA^3}$. This corresponds to the equilibrium lattice parameter $a_{\rm eq} \approx \unit[4.029]{\AA}$ at \unit[0]{K}, which we took as the initial lattice parameter for the following tasks.  

\begin{figure}[!ht]
\begin{center}
  \includegraphics[width=0.7\textwidth]{../figures/potential_energy} 
  \caption{The potential energy per unit cell for aluminum as a function of the lattice parameter cubed.}
  \label{fig1}
\end{center}
\end{figure}

We find that figure~\ref{fig1} looks similar to the figure~1 in the homework problem file. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Task 2: detmine the timestep}


With the random noise, the temperature and the energy are differs between runs, but are in the same order of magnitude. From figure~\ref{fig:task2}, we determine that $dt = \unit[5 \cdot 10^{-3}]{ps} = \unit[5]{fs}$ is a sufficient time step. This is in line with the lecture notes, where it is stated that the a suitable timestep would normally be a few femtoseconds, or somewhat larger for heavy atoms.
  
We note that the temperature is higher than desired value of~\unit[600-800]{K}. The temperatures and energies up to one standard deviation are quantified in table~\ref{tab:task2}. 



\begin{figure}[!ht]
\begin{center}
  \includegraphics[width=0.48\textwidth]{../figures/dt-scan-temperature} 
    \includegraphics[width=0.48\textwidth]{../figures/dt-scan-energy} 
  \caption{The temperature and kinetic energy per unit cell as a function of time for four different timesteps.}
  \label{fig:task2}
\end{center}
\end{figure}



\begin{table}[!ht]
  \begin{center}
    \caption{Energies and temperatures with one standard deviation uncertainties for four different values of the time steps.}
    \begin{tabular}{l c c} 
    $dt$ [ps] & $T$ [K] & $E_{\rm tot}$ [eV/unit cell]\\ \hline
$10^{-2}$ & 	$847 \pm 4.2\%$ &	$-12.55 \pm 1.2\cdot 10^{-2} \% $\\
$5\cdot 10^{-3}$ &	$1157 \pm$ 3.8 \% &$-12.24 \pm 3.6\cdot 10^{-3} \%$ \\
$2\cdot 10^{-3}$ & $1058  \pm 3.7 \% $ & 	$ -12.35 \pm 6.6\cdot 10^{-4} \% $\\ 
$1\cdot 10^{-3}$ & $ 841  \pm 3.7 \% $	 &$ -12.58 \pm 3.6\cdot 10^{-4} \%$ \\ 
      \hline
    \end{tabular}
    \label{tab:task2}
  \end{center}
\end{table}

\section*{Tasks 3 and 4: Temperature and pressure equilibration}
We set $\tau_P = \tau_T = 100 dt$, where $dt = 5\cdot 10^{-3}$\,ps, and equilibrated the temperature and pressure by scaling the particle momenta and positions (and box size) respectively. Choosing a slower equilibration time did not affect the results qualitatively. Both temperature and pressure were equilibrated in the same Verlet loop, but for the higher temperature the the system was first melted by increasing the temperature to \unit[900]{$^\circ$C}. To determine the isothermal compressibility $\kappa$, 
the values of Young's modulus $Y$ and shear modulus $G$ were taken from Physics Handbook, table T 1.1. From F 1.15 in Physics Handbook, the bulk modulus can then calculated as
\begin{equation}
B = \frac{YG}{9G - 3Y} \,\quad \kappa_{\rm Al} = \frac{1}{B} \approx \unit[6.6444\cdot 10^5]{bar},
\end{equation}
where \unit[1]{bar } = $\unit[6.2415\cdot 10^{-7}]{eV/\AA^3}$ in atomic units. \textbf{However, we set $\kappa = 100 \kappa_{\rm Al}$ since the pressure equilibration happened on a much longer timescale than $\tau_P$ with $\kappa = \kappa_{\rm Al}$. We have not yet figured out why this is. }

The results are shown in figure~\ref{fig:eq}, where we overlay the instantaneous values of $\mathcal{T}$ and $\mathcal{P}$ with a moving average using 250 time steps. The desired temperatures and pressures were approximatelyh obtained in the equilibration process. Although  the average pressure was slightly below zero, this is within the fluctuation error bars and is in line with the figure~2 in the homework problem document. 

\begin{figure}[!ht]
\begin{center}
  \includegraphics[width=0.48\textwidth]{../figures/TP-eq-500} 
    \includegraphics[width=0.48\textwidth]{../figures/TP-eq-700} 
  \caption{The instantaneous values of $\mathcal{T}$ and $\mathcal{P}$ overlayed with with a moving average using 100 time steps, which corresponds to $\Delta t = \tau_P/2$. Left panel: $T=\unit[500]{^\circ C}$,  right panel: $T=\unit[500]{^\circ C}$.}
  \label{fig:eq}
\end{center}
\end{figure}


The equilibrium values of the lattice parameter were found to be 
\begin{align}
a_0 &\approx \unit[4.10]{\AA}, \quad T=\unit[500]{^\circ C}, \\
a_0 &\approx \unit[4.29]{\AA}, \quad T=\unit[700]{^\circ C} .
\end{align} 

These value are larger than the zero-temperature constants, and it is reasonable that the higher $\unit[700]{^\circ C}$ case corresponds to a larger lattice parameter at constant pressure. 

\section*{Tasks 3-5: particle trajectories}

Starting with the temperature- and pressure equilibrated systems from the previous section, we study the particle trajectories for both systems. Here, we decrease the timestep to   $dt       = \unit[5\cdot 10^{-4}]{ps}$ and the simulation length to $t_{\rm end} = \unit[5]{ps}$ to get better statistics. This was mostly motivated by increasing the resolution in tasks 6-7. 

Equation (82) in MD lecture notes:


\begin{align}
\Delta_{\rm MSD}(t) &= \lim_{T \rightarrow \infty} \frac{1}{T} \int_0^{T} d t' \frac{1}{N_{\rm atoms}} \sum_{i=0}^{N_{\rm atoms}-1} \left[{\bf r}_i(t+t') - {\bf r}_i(t') \right]^2 \\ &\Rightarrow \nonumber
\\
\Delta_{\rm MSD}(t_k) &\approx
\frac{1}{N_T -k}\frac{1}{N_{\rm atoms}} \sum_{j=0}^{N_T-k-1} \sum_{i=0}^{N_{\rm atoms}-1} \left[{\bf r}_i(t_{k+j}) - {\bf r}_i(t_j) \right]^2 
\label{eq:1}
\end{align}


First, we note that the cumulative averages of the instantaneous temperatures and pressures stayed close to their inital values. This is shown in figure~\ref{fig:prod}.

\begin{figure}[!ht]
\begin{center}
  \includegraphics[width=0.48\textwidth]{../figures/TP-prod-500} 
    \includegraphics[width=0.48\textwidth]{../figures/TP-prod-700} 
  \caption{The instantaneous values, and the cumulative averages, of the temperature and the pressure in the production runs. Left panel: $T=\unit[500]{^\circ C}$,  right panel: $T=\unit[500]{^\circ C}$}
  \label{fig:prod}
\end{center}
\end{figure}

We now consider the particle trajectories. Figure~\ref{fig:MSD} shows the trajectories of five individual particles along with the mean square displacement as determined in equation~\eqref{eq:1}. We can clearly see that the particle trajectories are bounded in the left figure~\ref{fig:MSD}, while for the high-temperature case in the right panel, they increase as square root of time ($\Delta_{\rm MSD} \propto t$). Consequently, the former is in a solid state while the latter is in a liquid state. 

The self-diffusion coefficient as determined by the average slope of the mean square displacement, was calculated to $D_s \approx \unit[0.52]{\AA^2/ps}$.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!ht]
\begin{center}
  \includegraphics[width=0.48\textwidth]{../figures/MSD-500} 
    \includegraphics[width=0.48\textwidth]{../figures/MSD-700} 
  \caption{!!!!!!!!!!!!!!!!!!!!!!!! Left panel: $T=\unit[500]{^\circ C}$,  right panel: $T=\unit[500]{^\circ C}$}
  \label{fig:MSD}
\end{center}
\end{figure}




%To determine M, we used mean of ... for t $>$ ... 


\section*{Task 7}



The average ``power'' content in avariable , $X(t')$, at
some time, $t$, during some range of time, $T$, can be defined as
\begin{equation}
P_X(t,T) = \frac{1}{T}\int_{t-T/2}^{t+T/2}\dd{t'}\,X^2(t').
\end{equation}
This quantity can (in physically relevant systems) also be defined for
the process over all,
\begin{equation}
P_X = \lim_{T\to\infty} P_X(T)
= \lim_{T\to\infty} \frac{1}{T} \ev{\int_{0}^{T}\dd{t'}\,X^2(t')}.
\end{equation}
At this stage, we can introduce a 
We have the Fourier transform
\begin{equation}
\hat{f}(\omega) = \int_{-\infty}^{\infty}\dd{t} f(t)\ee^{\ii\omega t},
\end{equation}


Using these two functions, we can define a power spectrum
\begin{equation}
\begin{aligned}
\hat{P}(\omega) =& \ev{\abs{\hat{\vb*v}(\omega)}^2}_{\rm A}
=\ev{\hat{\vb*v}(\omega)\vdot \bar{\hat{\vb*v}}(\omega)}_{\rm A}\\
=& \ev{\int_{-\infty}^{\infty}\dd{t}\, \vb*v(t)\ee^{\ii\omega t}
  \int_{-\infty}^{\infty}\dd{t'}\, \vb*v(t')\ee^{-\ii\omega t'} }_{\rm A},
\end{aligned}
\end{equation}
where $\bar{\hat{\vb*v}}$ denotes the complex conjugate of
$\bar{\vb*v}$. We can now change varaibles to $t=t'+\tau$ and note
that the atom averages only falls on the velocities, which gives
\begin{equation}
\begin{aligned}
\hat{P}(\omega) 
=& \int_{-\infty}^{\infty}\dd\tau\, \ee^{\ii\omega\tau}
  \int_{-\infty}^{\infty}\dd{t'} \ev{\vb*v(t'+\tau)\vdot\vb*v(t') }_{\rm A},
\end{aligned}
\end{equation}


\begin{figure}[!ht]
\begin{center}
  \includegraphics[width=0.48\textwidth]{../figures/Phi-t} 
    \includegraphics[width=0.48\textwidth]{../figures/P-freq} 
  \caption{!!!!!!!!!!!!!!!!!!!!!!}
  \label{fig:spectrum}
\end{center}
\end{figure}

The self-diffusion coefficient as determined by the power spectral density at $f=0$, was found to be  $D_s = \unit[0.49]{\AA^2/ps}$, which is close to the value obtained from the mean square displacement, as expected.  


\section*{Concluding discussion}

!!!!!!!!!!!!!!!!!!!!!!!!!1

\newpage

\appendix

\section{Source Code}

Include all source code here in the appendix. Keep the code formatting clean,
use indentation, and comment your code to make it easy to understand. Also,
break lines that are too long. (Keep them under 80 characters!)

%\subsection{Calculating pi using matlab: \texttt{pi.m}}
%\lstinputlisting[language=matlab,numbers=left]{template_files/pi.m}

%\subsection{Calculating pi using python: \texttt{pi.py}}
%\lstinputlisting[language=python,numbers=left]{template_files/pi.py}

\subsection{Main program task 1: \texttt{main\_T1.c}}
\lstinputlisting[language=c,numbers=left]{../code/main_T1.c}

\subsection{Main program  Task 2: \texttt{main\_T2.c}}
\lstinputlisting[language=c,numbers=left]{../code/main_T2.c}

\subsection{Temperature and pressure equilibration for tasks 3-7 : \texttt{main\_T3.c}}
\lstinputlisting[language=c,numbers=left]{../code/main_T3.c}

\subsection{Production runs for tasks 3-7 : \texttt{main\_Prod.c}}
\lstinputlisting[language=c,numbers=left]{../code/main_Prod.c}

\subsection{Production runs for tasks 3-7 : \texttt{main\_Prod.c}}
\lstinputlisting[language=c,numbers=left]{../code/main_Prod.c}


\subsection{Misc functions : \texttt{funcs.c}}
\lstinputlisting[language=c,numbers=left]{../code/funcs.c}

\section{Auxiliary }
\subsection{Makefile}
\lstinputlisting[language=bash,numbers=left]{../code/Makefile}



\section{Matlab scripts}
\subsection{Analysis scripts for tasks 3-7: \texttt{Al\_energies.m}}
\lstinputlisting[language=matlab,numbers=left]{../m_scripts/H1_analysis.m}

\subsection{Improve figure appearance: \texttt{ImproveFigureCompPhys.m}}
\lstinputlisting[language=matlab,numbers=left]{../m_scripts/ImproveFigureCompPhys.m}

\subsection{Change size of figures: \texttt{setFigureSize.m}}
\lstinputlisting[language=matlab,numbers=left]{../m_scripts/setFigureSize.m}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
